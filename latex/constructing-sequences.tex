\section{Constructing Sequences Determining $\frac{b}{a}$ in $\zzzn$}

\par For any rational number $b/a$, $a$ relatively prime to $N$, there
exists a sequence $\xn \rightarrow b/a \in \zzzn$. At this point, it is
worth using the digit representation for integers in $\zzzn$. So
$\xn=\{x_0, \ x_0+x_1N, \ \dots, \ x_0+\dots+x_iN^i, \ \dots\}$ and
$b/a = x_0x_1\dots x_i\dots$. Rather than finding $a^{-1}\pmod{N^{i+1}}$ to
determine each $x_i$, it is not too difficult for every $i$ to find
$\sum_{k=0}^ix_kN^k$ such that
\begin{equation}\label{eq:seq-rational}
  b \equiv a\sum_{k=0}^ix_kN^k \pmod{N^{i+1}}.
\end{equation}
Then, 
\begin{equation}
  x_i = \frac{\sum_{k=0}^ix_kN^k - \sum_{k=0}^{i-1}x_kN^k}{N^i}.
\end{equation}

\par Nearly all of the digits for any rational number in $\zzzn$ can also be
found using powers of $N^{-1}$, which is much simpler to analyze than the
brute force search for the digits mentioned above.

\begin{theorem}\label{thm:10}
  Let $u_0,q,N\in\zzz$, where $q$ is relatively prime to $N$,
  $\lvert u_0 \rvert < q$, and $q=-q_0+\sum_{i=1}^{r}q_iN^i$ for
  $0 \leq q_i < N$. Define $\alpha = u_0/q \in \zzzn$
  such that $\alpha = \sum_{i=0}^{\infty}a_iN^i$ for $0 \leq a_i < N$.
  Also, define $u_k\in\zzz$ such that $u_k/q =
  \sum_{i=k}^{\infty}a_iN^{i-k} \in \zzzn$ and
  $\gamma \equiv N^{-1} \pmod q$. Then, there exist $u_k$ for every $k\geq0$
  such that
  \begin{equation}\label{eq:ak}
    a_k \equiv q^{-1}u_k \pmod N.
  \end{equation}
  If $-q<u_0<0$, then $u_k \in \{-q,\dots,-1\}$ for $k\geq0$.  Otherwise,
  for $k>\lfloor \log_N(q) \rfloor=r$, $u_k \in \{-q,\dots,-1\}$.
  \\ \\
  Let $\omega \in \{-q,\dots,-1\}$ such that $\omega \equiv
  \gamma^k u_0 \pmod q$.  Then for $k>\lfloor \log_N(q) \rfloor=r$, or if
  $-q<u_0<0$, then $k\geq0$,
  \begin{equation}\label{eq:ak-omega}
    a_k \equiv q^{-1}\omega \pmod N.
  \end{equation}
\end{theorem}
\noindent \\ 
\begin{proof}
  Write $u_0/q$ in terms of $u_k$.
  \begin{align}
    \frac{u_0}{q} &= a_0 + N\frac{u_1}{q}
                     = a_0 + a_1N + N^2\frac{u_2}{q}
                     = \dots \nonumber \\
                  &= \sum_{i=0}^{k-1}a_iN^i + N^k\frac{u_k}{q} \ \ 
                    \forall k \geq 1. \label{eq:u0/q}
  \end{align}
  Rewrite (\ref{eq:u0/q}) to be
  \begin{equation}\label{eq:u0/q-rw}
    p^ku_k=u_0-q\left(\sum_{i=0}^{k-1}a_ip^i\right) \ \ \forall k \geq 1
  \end{equation}
  Then $\lvert u_0 \rvert < q$ and $0 \leq a_i < p$ from the assumptions and
  equation (\ref{eq:u0/q-rw}). These imply for all $k \geq 1$,
  $\lvert u_0 \rvert = \lvert q\sum_{i=0}^{k-1}a_ip^i + p^ku_k \rvert < q$.
  Then,
  \begin{equation*}
%    -q-q\sum_{i=0}^{k-1}a_ip^i < p^k&u_k < q-q\sum_{i=0}^{k-1}a_ip^i \\
    -q\left(\frac{1+\sum_{i=0}^{k-1}a_ip^i}{p^k}\right)
      < \ u_k
      < q\left(\frac{1-\sum_{i=0}^{k-1}a_ip^i}{p^k}\right).
  \end{equation*}
  $u_k$ may only be greater than zero when $\frac{1-\sum_{i=0}^{k-1}a_ip^i}
  {p^k}$ is greater than zero. This only occurs when the sequence
  $(a_0,\dots,a_j) = (0,\dots,0)$ for $j\geq0$. Such a sequence occurs if
  and only if $u_0\geq0$ and $u_0 \equiv 0 \pmod{p^i}$ for $0\leq i \leq j$,
  $j\geq0$. This is clear from the construction of $N$-adic sequences for
  rational numbers. Therefore $u_k$ may only be greater than zero if
  $u_0\geq0$ and $u_0 \equiv 0 \pmod{p^i}$ for $0\leq i \leq j$, $j\geq0$.
  The lower bound for $u_k$ is greater than $-q$. This is clear because
  $\frac{1+\sum_{i=0}^{k-1}a_ip^i}{p^k}\leq1$.
  Therefore,
  \begin{equation*}
    -q < u_k < 0 {\rm \ \ for \ } -q<u_0<0.
  \end{equation*}
  If $0\leq u_0<q$, then the upper bound remains unchanged.
  \begin{equation*}
    -q < u_k < q\left(\frac{1-\sum_{i=0}^{k-1}a_ip^i}{p^k}\right)
      \ {\rm for} \ 0\leq u_0 < q
  \end{equation*}
  There is still work to be done on the upper bound.
  \begin{align*}
                &0 \leq \sum_{i=0}^{k-1}a_ip^i < p^k \ for \ k\geq1 \\
    \Rightarrow &-q(\sum_{i=0}^{k-1}a_ip^i) \leq 0 \\
    \Rightarrow \ &u_0-q(\sum_{i=0}^{k-1}a_ip^i)<q \\
    \Rightarrow \ &p^ku_k<q \\
    \Rightarrow \ &u_k<\frac{q}{p^k}.
  \end{align*}
  For $k>\lfloor\log_p(q)\rfloor=r$, $\lvert q/p^k \rvert < 1$. Therefore,
  $-q < u_k < 0 \ {\rm for} \ 0\leq u_0 < q \ {\rm and} \ k>r$.
  Further lowering the upperbound, if $u_k=0$, then
  $u_0/q=\sum_{i=0}^{k-1}a_ip^i+0$. This implies $u_0/q$ is a rational
  integer, which is not true. Noting finally that $u_k$ must be an integer.
  If $\lvert u_0 \rvert<q$ and $u_0<0$, or $\lvert u_0 \rvert<q$,
  $u_0\geq0$, and $k>\lfloor \log_p(q) \rfloor=r$, then
  \begin{equation*}
    u_k \in \{-q,\dots,-1\}.
  \end{equation*}
  It has now been shown, for certain restrictions, $u_k$ belongs to a
  specific set of representatives for the residue classes of $\zzz/(q)$.
  Define $\gamma \equiv p^{-1} \pmod q$. Reducing Equation
  (\ref{eq:u0/q-rw}) modulo $q$ shows that
  \begin{equation}
    u_k \equiv \gamma u_{k-1} \pmod q.
  \end{equation}
  Since this is true for all k greater than or equal to 1, it is clear that
  \begin{equation}\label{eq:uk-mod-q}
    u_k \equiv \gamma^ku_0 \pmod q.
  \end{equation}
  Reducing (\ref{eq:u0/q-rw}) modulo $p$ shows that
  \begin{equation}\label{eq:ak-mod-p}
    a_k \equiv q^{-1}u_k \pmod p.
  \end{equation}
  Define $\omega \equiv \gamma^k u_0 \pmod q$, and
  $\rho \equiv q^{-1} \pmod p$.  Finally, if $\lvert u_0 \rvert<q$ and
  $u_0<0$, or $\lvert u_0 \rvert<q$, $u_0\geq0$, and
  $k>\lfloor \log_p(q) \rfloor=r$, then
  \begin{equation}\label{eq:ak-done}
    a_k \equiv \rho\omega \pmod p.
  \end{equation}
\end{proof}
\begin{corollary}\label{cor:aj}
  Let $0\leq u_0 < q$. Define $j$ to be the greatest integer such that
  $u_0 \equiv 0 \pmod{p^j}$. Then the following are true:
  \begin{enumerate}[i.]
%    \item $j\leq\lfloor\log_p{q}\rfloor = r$
    \item $(a_0,\dots,a_{j-1})=(0,\dots,0)$
    \item $u_k>0$ for $k=j$
    \item $u_k \not\equiv 0 \pmod p$
  \end{enumerate}
\end{corollary}
\par The results of this corollary are straightforward.

\par Theorem \ref{thm:10} shows that for $-q<u_0<0$, there is a sequence of
numerators $\{u_k\}$ directly related to the sequence of digits $\{a_k\}$
for $u_0/q\in\zzzn$. This is provides a more powerful tool for the analysis
of the sequences generated by AFSRs. The results shown here fill in the gaps
of the incomplete proof shown in Theorem 10 of Klapper and Xu's paper
\cite{art:kx99}.

\begin{corollary}
% 2-adic case for theorem 10
\end{corollary}
